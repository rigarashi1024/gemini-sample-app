# REVIEW_RULES_SUMMARY.md（要約版、GEMINIのプロンプトに乗せるよう）

以下は PurposeSurvey プロジェクトにおける PRレビュー用の要約仕様・要件・指摘基準です。
Gemini（レビューAI）はこれに従い、Critical Issue（bug / security / logic）のみ指摘します。

------------------------------------------------------------
1. プロジェクト概要（要約）
------------------------------------------------------------
PurposeSurvey は、
「目的を入力 → AI が質問を生成 → 回答収集 → 集計 → 推奨を返す」
という汎用アンケート生成・分析アプリです。

主な流れ:
1. ユーザーが目的を入力
2. AI が質問セット（3〜10問）を生成
3. 回答URLを発行して回答を収集
4. 集計（質問形式に応じた集計）
5. AI が要約と推奨アクションを生成

POCの非対象: 認証 / 外部API接続 / 高度レポート / 通知など。

------------------------------------------------------------
2. 技術スタック（要約）
------------------------------------------------------------
- Next.js 14 (App Router)
- TailwindCSS / shadcn/ui
- Supabase（PostgreSQL）＋ Prisma
- AI: Claude（実装）、Gemini（PRレビュー）
- デプロイ: Vercel

------------------------------------------------------------
3. データモデル（重要箇所）
------------------------------------------------------------

[Purpose]
- title, description
- questions（AI生成の Questions JSON）
- shareToken, deadline
- createdAt / updatedAt

[Response]
- purposeId
- clientId（ブラウザ単位の匿名ID）
- respondentName（任意）
- answers（QuestionId と回答値）
- （purposeId, clientId）をユニークとして重複回答防止

[Question JSON]
id, label, type, options?, required

------------------------------------------------------------
4. 画面フロー（要点）
------------------------------------------------------------

[目的作成 → AI質問生成 → 編集 → 保存]
- 保存操作で Purpose を作成
- 質問再生成で置き換え可能

[回答ページ]
- Purpose.questions を動的レンダリング
- clientId を localStorage に保持
- 送信すると Response 作成 → 集計ページへ
- 個人特定情報は表示しない

[集計・AI解析]
- 質問形式ごとの適切な方法で集計
- 締切後回答の含める/除外を切替可能
- AI が要約＋推奨を生成

------------------------------------------------------------
5. PRレビュー方針（Gemini用）
------------------------------------------------------------

Gemini は **Critical Issue のみ** 指摘する。

[指摘すべきもの]
- bug: null/undefined、型破綻、runtime error、誤動作
- security: XSS、漏洩、入力未検証
- logic: 仕様矛盾、整合性崩壊、データ誤処理

[指摘禁止（Optional扱い）]
- スタイル（Tailwind並びなど）
- フォーマット（改行・インデント）
- 命名の好み
- 軽微な提案・パフォーマンス微最適化
- 既に修正済箇所の再指摘

[Next.js / DBでのCritical観点]
- server/client の誤配置
- Route Handler のロジック破綻
- Prisma 型不一致、where 条件ミス
- 不正入力の未検証

------------------------------------------------------------
6. 出力形式（厳守）
------------------------------------------------------------

Issue-1:
  type: bug | security | logic
  file: <path>
  lines: <range>
  problem: ...
  reason: ...
  suggestion: ...

Issue-2:
  ...

問題なければ:
No major issues. LGTM.

------------------------------------------------------------
7. Claude との役割分担
------------------------------------------------------------
- Gemini: Critical のみ指摘
- Claude: 指摘に基づき修正
- 重複指摘禁止
- 誤認識（誤った指摘）は避ける

------------------------------------------------------------
# End of Summary
------------------------------------------------------------
